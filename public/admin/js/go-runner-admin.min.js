/*
* goRunner v.0.0.1
* (c) 2014, Obogo
* License: Obogo 2014. All Rights Reserved.
*/
!function(a){"use strict";function b(c){for(var d,e,f=a.util.array.toArray(arguments),g=1,h=f.length,i=this||{};h>g;){d=f[g];for(e in d)d.hasOwnProperty(e)&&(c[e]&&"object"==typeof c[e]?c[e]=b.apply(i,[c[e],d[e]]):d[e]instanceof Array?(c[e]=c[e]||(i&&i.arrayAsObject?{length:d[e].length}:[]),d[e].length&&(c[e]=b.apply(i,[c[e],d[e]]))):c[e]=d[e]&&"object"==typeof d[e]?b.apply(i,[c[e]||{},d[e]]):d[e]);g+=1}return c}function c(b,c){var d,e,f,g=0;if(arguments.length>2&&(f=a.util.array.toArray(arguments),f.splice(0,2)),b&&b.length)for(d=b.length;d>g;){if(e=c.apply(null,[b[g],g,b].concat(f)),void 0!==e)return e;g+=1}else if(!(b instanceof Array))for(g in b)if(b.hasOwnProperty(g)&&(e=c.apply(null,[b[g],g,b].concat(f)),void 0!==e))return e;return b}function d(a){var b=[],c=0,d=a.length;if(void 0!==a.length)for(;d>c;)b.push(a[c]),c+=1;else for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b}function e(a,b){var c,d,e,f,g;for(b||(b=function(a,b){return a>b?1:b>a?-1:0}),d=a.length,f=d-1,c=0;d>c;c+=1)for(e=0;f>e;e+=1)b(a[e],a[e+1])>0&&(g=a[e+1],a[e+1]=a[e],a[e]=g);return a}function f(a,b){this.name=a,this.style=b}function g(a){var b;return b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),b.open("GET",a,!1),b.send(null),b.responseText}{var h=a.runnerAdmin=a.runnerAdmin||{},i=window;i.document}h.events={admin:{START:"runner:start",STOP:"runner:stop",UPDATE:"runner:update",RESET:"runner:reset",DONE:"runner:done",START_RECORDING:"runner:startRecording",STOP_RECORDING:"runner:stopRecording",LOAD_TEST:"runner:loadTest",REGISTER_SCENARIO:"runner:registerScenario"},runner:{ON_START:"runner:onStart",ON_STOP:"runner:onStop",ON_UPDATE:"runner:onUpdate",ON_RESET:"runner:onReset",ON_DONE:"runner:onDone",ON_START_RECORDING:"runner:onStartRecording",ON_STOP_RECORDING:"runner:onStopRecording",ON_LOAD_TEST:"runner:onLoadTest",ON_REGISTER_SCENARIO:"runner:onRegisterScenario"}},a.extend=b,a.each=c,a.util=a.util||{},a.util.array=a.util.array||{},a.util.array.toArray=d,a.util.array.sort=e,a.charPack=function(a,b){for(var c="";c.length<b;)c+=a;return c},f.prototype.log=function(b){var c,d,e=a.util.array.toArray(arguments);b&&b.uid&&(c=b.uid.split(".").length,d=a.charPack("	",c)+b.uid+":"+b.type+":"+b.status+":"+b.state+":["+b.progress+"]::",e.shift(),e[0]=d+e[0]),this.applyName(e),this.applyStyle(e),console.log.apply(console,e)},f.prototype.applyName=function(a){var b=a[0];if(this.name){var c=0;if("string"==typeof b&&"	"===b.charAt(c)){for(;"	"===b.charAt(c);)c+=1;c&&(b=b.substr(0,c)+this.name+b.substr(c+1))}b=this.name+"::"+b,a[0]=b}},f.prototype.applyStyle=function(a){this.style&&(a[0]="%c"+a[0],a.splice(1,0,this.style))};{var j;new f}!function(){function a(){return c.pop()||[]}function b(a){a.length=0,c.length<d&&c.push(a)}var c=[],d=40,e=function(a,b,c){var d,e=a,g=e;if(!e)return g;if(!f[typeof e])return g;b=b&&"undefined"==typeof c?b:baseCreateCallback(b,c,3);for(d in e)if(b(e[d],d,a)===!1)return g;return g};if(window._)j=window._;else{Array.prototype.isArray=!0,j={},j.extend=function(a,b){a=a||{};for(var c in b)b.hasOwnProperty(c)&&(a[c]="object"==typeof b[c]?j.extend(a[c],b[c]):b[c]);return a},j.isString=function(a){return"string"==typeof a},j.isBoolean=function(a){return"boolean"==typeof a},j.isNumber=function(a){return"number"==typeof a},j.isArray=function(a){return a?!!a.isArray:!1},j.isEmpty=function(a){if(j.isString(a))return""===a;if(j.isArray(a))return 0===a.length;if(j.isObject(a)){for(var b in a)return!1;return!0}return!1},j.isUndefined=function(a){return"undefined"==typeof a},j.isFunction=function(a){return"function"==typeof a},j.isObject=function(a){return"object"==typeof a},j.isDate=function(a){return a instanceof Date};var f={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},g="[object Arguments]",h="[object Array]",i="[object Boolean]",k="[object Date]",l="[object Number]",m="[object Object]",n="[object RegExp]",o="[object String]";j.isEqual=function p(c,d,j,q,r,s){if(j){var t=j(c,d);if("undefined"!=typeof t)return!!t}if(c===d)return 0!==c||1/c==1/d;var u=typeof c,v=typeof d;if(!(c!==c||c&&f[u]||d&&f[v]))return!1;if(null==c||null==d)return c===d;var w=toString.call(c),x=toString.call(d);if(w==g&&(w=m),x==g&&(x=m),w!=x)return!1;switch(w){case i:case k:return+c==+d;case l:return c!=+c?d!=+d:0==c?1/c==1/d:c==+d;case n:case o:return c==String(d)}var y=w==h;if(!y){var z=hasOwnProperty.call(c,"__wrapped__"),A=hasOwnProperty.call(d,"__wrapped__");if(z||A)return p(z?c.__wrapped__:c,A?d.__wrapped__:d,j,q,r,s);if(w!=m)return!1;var B=c.constructor,C=d.constructor;if(B!=C&&!(isFunction(B)&&B instanceof B&&isFunction(C)&&C instanceof C)&&"constructor"in c&&"constructor"in d)return!1}var D=!r;r||(r=a()),s||(s=a());for(var E=r.length;E--;)if(r[E]==c)return s[E]==d;var F=0;if(t=!0,r.push(c),s.push(d),y){if(E=c.length,F=d.length,t=F==E,t||q)for(;F--;){var G=E,H=d[F];if(q)for(;G--&&!(t=p(c[G],H,j,q,r,s)););else if(!(t=p(c[F],H,j,q,r,s)))break}}else e(d,function(a,b,d){return hasOwnProperty.call(d,b)?(F++,t=hasOwnProperty.call(c,b)&&p(c[b],a,j,q,r,s)):void 0}),t&&!q&&e(c,function(a,b,c){return hasOwnProperty.call(c,b)?t=--F>-1:void 0});return r.pop(),s.pop(),D&&(b(r),b(s)),t}}}();var k,l=angular.module("admin",["ux"]).run(["$rootScope",function(a){k=a}]),m={};l.controller("myController",function(a){a.sampleData={events:[],root:{}},go.each(h.events.runner,function(b){a.$on(b,function(){var b=go.util.array.toArray(arguments);b[0]=b[0].name,j.extend(m,arguments[1]),a.sampleData.root?go.extend(a.sampleData.root,m):a.sampleData.root=m,a.sampleData.events.push(b)})}),a.parseXML=function(){var c=go.runnerAdmin.xml.parse(a.xmlData);return console.log(c),b.apply({arrayAsObject:!0},[{},c])},a.sendTest=function(){a.$emit(h.events.admin.LOAD_TEST,a.parseXML()),a.xmlData=""},a.registerScenario=function(){a.$emit(h.events.admin.REGISTER_SCENARIO,a.parseXML()),a.xmlData=""},a.setScenarioXML=function(){a.xmlData=g("xml/registerScenarioSimple.xml")},a.setSimpleXML=function(){a.xmlData=g("xml/simple.xml")},a.start=function(){a.$emit(h.events.admin.START,a.startNode)},a.stop=function(){a.$emit(h.events.admin.STOP)},a.reset=function(){a.$emit(h.events.admin.RESET)}}),function(){function b(a){return"true"===a||"false"===a?"true"===a:""!==a&&a&&!isNaN(a)?parseFloat(a):a}function c(a){if("condition"===a.type){a.conditions=[];for(var b=0,e=a.steps.length;e>b;)d.each(a.steps,c),a.conditions.push(a.steps[b]),b+=1;a.steps=[]}}var d={extend:a.extend,each:a.each,isArray:j.isArray};d.extend(d,{parse:function(a){var b;return a=this.closeOpenNodes(a),a=a.replace(/<(\w+)/g,'<steps type="$1"'),a=a.replace(/<\/\w+/g,"</steps"),b=this.xml2json(a),this.each(b.steps,c),b},closeOpenNodes:function(a){return a=a.replace(/<(\w+)\/>/gim,"<$1></$1>"),a=a.replace(/(<(\w+)[^>]+?)\/>/gim,"$1></$2>")},xml2json:function(a,c){function e(a,h){if(!a)return null;{var i,j="",k=null,l=null;a.nodeType,f(a.localName||a.nodeName),a.text||a.nodeValue||""}a.childNodes&&a.childNodes.length>0&&d.each(a.childNodes,function(a){var b=a.nodeType,c=f(a.localName||a.nodeName),d=a.text||a.nodeValue||"";if(8!==b)if(3!==b&&4!==b&&c)k=k||{},k[c]?(k[c].length||(k[c]=g(k[c])),k[c]=g(k[c]),k[c][k[c].length]=e(a,!0),k[c].length=k[c].length):k[c]=e(a);else{if(d.match(/^\s+$/))return;j+=d.replace(/^\s+/,"").replace(/\s+$/,"")}}),j&&(j=b(j)),a.attributes&&a.attributes.length>0&&(l={},k=k||{},d.each(a.attributes,function(a){var c=f(a.name),d=a.value;"xmlns"!==c&&(l[c]=d,k[c]?(k[i]=g(k[i]),k[c][k[c].length]=d,k[c].length=k[c].length):k[c]=b(d))})),k&&(""===j&&(k=d.extend({},k||{})),j=k.text?"object"==typeof k.text?k.text:k.txt||j||"":j,void 0!==j&&""!==j&&(k.text=j),j="");var m=k||j;return c&&(j&&(m={}),j=m.text||j||"",j&&(m.text=j),h||(m=g(m))),m}if(!a)return{};var f=function(a){return String(a||"").replace(/-/g,"_")},g=function(a){return d.isArray(a)||(a=[a]),a.length=a.length,a};if("string"==typeof a&&(a=d.text2xml(a)),a.nodeType){if(3===a.nodeType||4===a.nodeType)return a.nodeValue;var h=9===a.nodeType?a.documentElement:a,i=e(h,!0);return a=null,h=null,i}},text2xml:function(a){var b,c;try{c=DOMParser?new DOMParser:new ActiveXObject("Microsoft.XMLDOM"),c.async=!1}catch(d){throw new Error("XML Parser could not be instantiated")}try{b=DOMParser?c.parseFromString(a,"text/xml"):c.loadXML(a)?c:!1}catch(d){throw new Error("Error parsing XML string")}return b}}),h.xml=d}();var n={config:{GOINSTANT_URL:"https://goinstant.net/0fc17c9b2a8f/runner-dev"},events:{ON_USER_READY:"onUserReady",ON_CONNECTION_SUCCESS:"onConnectionSuccess",ON_CONNECTION_ERROR:"onConnectionError",ON_TRACK_CONNECTION_SUCCESS:"onTrackConnectionSuccess",ON_TRACK_CONNECTION_ERROR:"onTrackConnectionError"}},o={name:"ProjectA"},p={displayName:"Admin Panel",isAdmin:!0,visible:!1,ua:navigator.userAgent,tracks:{},scenarios:{}},q={};!function(){var a={},b=new f("serviceConst","color:#FF0099");n.on=function(c,d){b.log("on %s",c);var e=a[c];"undefined"==typeof e&&(e=a[c]=[]),e.push(d)},n.dispatch=function(c,d,e){b.log("dispatch %s",c);var f,g=a[c],h=0;if("undefined"!=typeof g)for(d=d instanceof Array?d:[d],e=e||n,f=g.length;f>h;)g[h].apply(e,d),h+=1}}(),function(){function a(){i.log("init"),n.on(n.events.ON_USER_READY,c)}function b(){i.log("connect"),h.isConnected=!1,e=new goinstant.Connection(n.config.GOINSTANT_URL),e.connect(g,d)}function c(a){i.log("onUserReady"),g=a,b()}function d(a){return i.log("onConnection"),a?(h.isConnected=!1,n.dispatch(n.events.ON_CONNECTION_ERROR,a)):(h.isConnected=!0,void n.dispatch(n.events.ON_CONNECTION_SUCCESS,e))}var e,g,h=this||{},i=new f("socketService","color:#FF00FF");h.isConnected=!1,a()}(),function(){function a(){h.log("init"),n.on(n.events.ON_USER_READY,b),n.on(n.events.ON_PROJECT_READY,d),n.on(n.events.ON_CONNECTION_SUCCESS,c)}function b(a){h.log("onUserRead"),e=a}function c(a){h.log("onConnectionSuccess"),g=a.room(e.name),g.join().then(function(a){n.dispatch(n.events.ON_TRACK_CONNECTION_SUCCESS,a.room)},function(a){h.log("	ERROR: %o",a),n.dispatch(n.events.ON_TRACK_CONNECTION_ERROR,a)})}function d(a){h.log("onProjectReady %o",a),e=a}var e,g,h=new f("trackRoomService","color:#9900FF");a()}(),function(){function b(b){function d(d){var e=d.id.split(":").pop(),f=b.channel(e);c.log("connected on chanel %s",e),f.on("message",function(b){c.log("message received from %s",d.id);var e=a.util.array.toArray(b);k.$broadcast.apply(k,e)})}function e(a){var d="/.users/"+a.id+"/progress";b.key(d).on("set",function(a){c.log("	console update %s",a.percent)})}function f(a){a.isAdmin||q[a.id]||(c.log("	User Joined %s",a.displayName),q[a.id]=a,d(a),e(a))}function g(a){q[a.id]&&(b.channel(a.id).off("message"),delete q[a.id],c.log("	User Left %s",a.displayName))}function i(){var b=a.util.array.toArray(arguments);a.each(q,j,b)}function j(d,e,f,g){g[0]=g[0].name;var h=d.id.split(":").pop(),i=b.channel(h),j=a.extend.apply({arrayAsObject:!0},[{},g]);c.log("	sendToDevice on channel %s %o",h,j),i.message.apply(i,[j])}function l(a,b){k.$on(a,b)}function m(b,c){a.each(q,n,c)}function n(a,d,e,f){var g="/.users/"+a.id+"/track";b.key(g).set(f,function(a){a&&c.log(a)})}function o(b,c){a.each(q,p,c)}function p(a,d,e,f){var g="/.users/"+a.id+"/scenarios";b.key(g).set(f,function(a){a&&c.log(a)})}c.log("Track connected"),b.users.get(function(b,d){c.log("TrackUsers.get() %o",d),a.each(d,f)}),b.on("join",f),b.on("leave",g),b.channel("public").on("message",function(a,b){c.log("message received on PUBLIC",a,b)}),l(h.events.admin.START,i),l(h.events.admin.STOP,i),l(h.events.admin.RESET,i),l(h.events.admin.START_RECORDING,i),l(h.events.admin.STOP_RECORDING,i),l(h.events.admin.LOAD_TEST,m),l(h.events.admin.REGISTER_SCENARIO,o)}var c=new f("trackRoomListeners","color:#6633FF");n.on(n.events.ON_TRACK_CONNECTION_SUCCESS,b),c.log("what is ua",navigator.userAgent),n.dispatch(n.events.ON_USER_READY,p),n.dispatch(n.events.ON_PROJECT_READY,o)}()}(this.go=this.go||{},function(){return this}());